# Publishing Process

This repository publishes packages from CI.

## What triggers publishing artifacts

- CI runs on:
  - `pull_request`
  - `push` on `main`
  - `push` on `release/**`
- GitHub Release job runs only on pushes to `main` or `release/**`.

## Branch strategy

- `main`: prerelease flow (`-dev.*`).
- `release/*`: release branch flow (same packaging pipeline, intended for release stabilization).
- Branch name format can be `release/<target>` (for example: `release/0.9` or `release/1.0`).

## Versioning (`version.json`)

- Versioning is handled by Nerdbank.GitVersioning.
- `version.json` is **never updated automatically** by CI.
- Current prerelease pattern is defined in `version.json`:
  - `"version": "0.9.0-dev.{height}"`
- You must update the `version` field manually in a commit, when you decide to change version line/policy.
- `publicReleaseRefSpec` already includes `main` and `release/*`, so package/release versions generated by CI do not include the `.g<sha>` suffix.

### When should I modify it?

- Usual flow:
  - On `main`, keep a moving prerelease pattern (for example `0.9.0-dev.{height}`).
  - When you cut `release/*`, change `version.json` on that branch only if you want a different version stream there (for example `0.9.0-rc.{height}` or `0.9.0`).
  - After cutting release, bump `main` to the next line (for example `0.10.0-dev.{height}`).
- If you do not change `version.json` on `release/*`, that branch keeps the same version pattern inherited from `main`.

## Do I need to create a Git tag manually?

- No for normal flow.
- On push to `main`/`release/*`, CI creates a GitHub Release with tag `v<NuGetPackageVersion>`.
- Only create tags manually for exceptional/manual workflows.

## NuGet publish status

- Package build + symbols (`.snupkg`) are produced by CI.
- NuGet push step exists in workflow but is currently disabled:
  - `.github/workflows/ci.yml` -> `Publish to NuGet` has `if: false`.
- To actually publish to NuGet.org, enable that step and ensure `NUGET_API_KEY` is configured.
